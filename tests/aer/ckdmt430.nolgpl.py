import pyarts3 as pyarts
import numpy as np

f = pyarts.arts.convert.kaycm2freq(np.linspace(1, 21000, 101))

atm = pyarts.arts.AtmPoint()
atm.pressure = 1e4
atm.temperature = 250
atm["H2O"] = 1e-2
atm["O2"] = 0.21
atm["N2"] = 0.79
atm["CO2"] = 400e-6

data = pyarts.arts.PredefinedModelData.fromcatalog(
    "predef/", ["H2O-ForeignContCKDMT430", "H2O-SelfContCKDMT430"])
self_abs430 = pyarts.arts.predef.get_self_h2o_ckdmt430(f, atm, data)

self_ref430 = np.array([9.189769485196123e-08, 0.00015672443964545764, 2.828567174136117e-05, 6.82934630694487e-06, 2.31784464198272e-06, 9.338268580595634e-07, 1.0150564159771669e-06, 1.3946352148593543e-05, 3.35576519056182e-05, 3.155020968821078e-06, 3.3110859725448607e-07, 1.1828277073222903e-07, 7.970201899486387e-08, 7.040290750406673e-08, 6.865340996887612e-08, 2.641005338718162e-07, 3.5717897145869486e-07, 4.7076306017478115e-06, 3.331919198050135e-05, 3.0987459088601393e-06, 3.405220909158323e-07, 1.0449903360012003e-07, 5.669348482088639e-08, 3.976407475026572e-08, 1.258345493843198e-07, 2.1135362269250405e-06, 1.5449048918439632e-06, 1.1304034976872388e-07, 1.381234985540996e-08, 4.684258924732471e-09, 1.7726928396765135e-09, 2.8902352810231995e-09, 2.9352272376466614e-08, 2.041011824740944e-07, 1.11615891644693e-06, 1.3959529838216589e-06, 3.757626351318345e-08, 9.392836675790163e-09, 3.1335903767654105e-09, 1.891029307896446e-09, 6.334118887208509e-09, 1.541906176479611e-08, 1.434519916280068e-07, 1.7949581469070985e-08, 1.8374221406216735e-09, 3.034352571384538e-10, 1.256664878354076e-10, 1.7914391968122892e-10,
                       4.695406649008256e-10, 9.644526379116789e-09, 3.991877107055666e-08, 5.577032679652794e-08, 9.776385876462862e-09, 2.681467780647672e-09, 2.4594165638143186e-10, 8.075010034164904e-11, 1.7158714232860604e-10, 8.453038131779653e-10, 5.964159820651672e-09, 7.736888970912498e-10, 4.5668251448705797e-10, 2.272329180160134e-11, 8.54905969452266e-12, 1.2467607396074576e-11, 9.415417117784018e-11, 1.2582833391642096e-09, 5.260224157224619e-09, 5.787001976490031e-10, 9.117492050126759e-10, 7.984672010826418e-11, 1.1636144604285995e-11, 5.73396009633933e-12, 4.1935292651322185e-11, 4.0174862858364136e-10, 7.64266593823464e-11, 5.246484283138208e-11, 1.2275152960302711e-11, 1.834850320760551e-12, 2.633074946638328e-12, 2.500272873850917e-11, 4.326785318794734e-10, 2.843254127172161e-10, 2.8687728193111663e-11, 7.728086311487542e-11, 2.919402391994982e-11, 2.844196687045464e-12, 3.475921372335562e-12, 4.452886673681736e-11, 5.0370099330552684e-11, 3.7923483221681875e-12, 5.051790656967964e-12, 4.302202552617765e-12, 1.2762346648918725e-12, 1.7784717281522425e-11, 2.3544525876029757e-10, 6.980840078950065e-11, 0, 0, 0, 0, 0])

assert np.allclose(self_abs430, self_ref430)

foreign_abs430 = pyarts.arts.predef.get_foreign_h2o_ckdmt430(f, atm, data)

foreign_ref430 = np.array([7.902266623188642e-08, 0.0006804823452410723, 2.0650827472669016e-05, 1.5494470651488873e-06, 2.5342231495509236e-07, 5.967529722919267e-08, 5.815802888579568e-07, 9.904785169274852e-05, 0.00019247804755044107, 6.549311134655636e-06, 1.675557700066427e-07, 7.84695662567049e-09, 6.105296568147661e-10, 1.7527915546953446e-08, 4.430398440459728e-08, 9.023142674259312e-07, 5.566073153956493e-07, 1.8528804208045185e-05, 0.0001495671313017644, 3.677807698290886e-06, 2.2059324732365718e-07, 4.897731096016647e-08, 2.3098324858751777e-08, 9.421673949704309e-09, 6.65688595136048e-08, 1.2655474801617041e-05, 9.250995620191857e-06, 7.700748348142169e-08, 6.3951274391930446e-09, 1.663946175343862e-09, 6.469483812292643e-10, 1.1793993788786671e-09, 1.5608740386529944e-07, 1.007438289565876e-06, 8.320868435168207e-06, 1.0990592003915888e-05, 8.995168782438871e-08, 4.517692598010068e-09, 8.131593496846035e-10, 5.629520619439137e-09, 2.9053744485723974e-08, 3.6156695835010906e-08, 7.560311192203557e-07, 3.9082335659897955e-08, 1.8146220815061607e-09, 8.108050525642898e-11, 5.1101029727081085e-11, 6.031839093432586e-10,
                          5.284200635836903e-10, 3.689465532566e-08, 2.397017019526437e-07, 3.8074241944156685e-07, 4.186473530174785e-08, 3.996397860832967e-08, 3.491776191286313e-10, 4.476140038136932e-11, 8.27111519245472e-10, 2.346524342356196e-09, 3.085759166469117e-08, 1.6341807382578892e-09, 2.3556072044686797e-09, 5.1813725236032335e-11, 4.647791447739354e-12, 1.6596224053830763e-11, 1.0274165828068133e-10, 6.356948828449977e-09, 2.644954523789432e-08, 8.788315971000534e-10, 4.615461603953291e-09, 4.554902147533082e-10, 2.6296699683976694e-11, 5.463385386907692e-12, 1.0915201724324435e-10, 1.9647916317184522e-09, 1.8962542685691598e-10, 2.8742125364309394e-10, 1.630068788521999e-10, 1.8915259645837643e-12, 9.720265339143444e-13, 4.239783567472467e-11, 2.680059704535967e-09, 1.3445087334163242e-09, 4.781183249844617e-11, 4.086265358766565e-10, 7.517071282845343e-11, 9.347318522372578e-12, 3.2018861813102984e-12, 1.632918025252812e-10, 2.16510087407733e-10, 9.357561495983835e-12, 1.8271742567814066e-11, 9.875231659355349e-12, 1.6577468424120544e-12, 1.365083919554613e-11, 4.4075812656506807e-10, 5.577567615725717e-11, 0, 0, 0, 0, 0])

assert np.allclose(foreign_abs430, foreign_ref430)
