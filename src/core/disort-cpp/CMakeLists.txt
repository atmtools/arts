add_library(disort-cpp STATIC disort.cpp)

target_link_libraries(disort-cpp PUBLIC matpack legendre artstime operators)
target_include_directories(disort-cpp PUBLIC ${CMAKE_CURRENT_SOURCE_DIR})

# Add tests, split them because they contain too much data otherwise
add_executable(disort-cpp-test-1 disort-test-1.cpp)
add_executable(disort-cpp-test-2 disort-test-2.cpp)
add_executable(disort-cpp-test-3 disort-test-3.cpp)
add_executable(disort-cpp-test-4 disort-test-4.cpp)
add_executable(disort-cpp-test-5 disort-test-5.cpp)
add_executable(disort-cpp-test-8 disort-test-8.cpp)
add_executable(disort-cpp-test-9 disort-test-9.cpp)
add_executable(disort-cpp-test-11 disort-test-11.cpp)
add_executable(disort-test-clearsky-multilayer disort-test-clearsky-multilayer.cpp)

target_link_libraries(disort-cpp-test-1 disort-cpp artstime)
target_link_libraries(disort-cpp-test-2 disort-cpp artstime)
target_link_libraries(disort-cpp-test-3 disort-cpp artstime)
target_link_libraries(disort-cpp-test-4 disort-cpp artstime)
target_link_libraries(disort-cpp-test-5 disort-cpp artstime)
target_link_libraries(disort-cpp-test-8 disort-cpp artstime)
target_link_libraries(disort-cpp-test-9 disort-cpp artstime)
target_link_libraries(disort-cpp-test-11 disort-cpp artstime)
target_link_libraries(disort-test-clearsky-multilayer disort-cpp artstime)

add_test(NAME "cpp.fast.disort-cpp-test-1" COMMAND disort-cpp-test-1)
add_test(NAME "cpp.fast.disort-cpp-test-2" COMMAND disort-cpp-test-2)
add_test(NAME "cpp.fast.disort-cpp-test-3" COMMAND disort-cpp-test-3)
add_test(NAME "cpp.fast.disort-cpp-test-4" COMMAND disort-cpp-test-4)
add_test(NAME "cpp.fast.disort-cpp-test-5" COMMAND disort-cpp-test-5)
add_test(NAME "cpp.fast.disort-cpp-test-8" COMMAND disort-cpp-test-8)
add_test(NAME "cpp.fast.disort-cpp-test-9" COMMAND disort-cpp-test-9)
add_test(NAME "cpp.fast.disort-cpp-test-11" COMMAND disort-cpp-test-11)
add_test(NAME "cpp.fast.disort-test-clearsky-multilayer" COMMAND disort-cpp-test-11)

add_dependencies(check-deps disort-cpp-test-1)
add_dependencies(check-deps disort-cpp-test-2)
add_dependencies(check-deps disort-cpp-test-3)
add_dependencies(check-deps disort-cpp-test-4)
add_dependencies(check-deps disort-cpp-test-5)
add_dependencies(check-deps disort-cpp-test-8)
add_dependencies(check-deps disort-cpp-test-9)
add_dependencies(check-deps disort-cpp-test-11)
add_dependencies(check-deps disort-test-clearsky-multilayer)

if (NOT ENABLE_ARTS_LGPL AND NOT CMAKE_CXX_COMPILER_ID MATCHES MSVC)
  add_executable(test-old-impl test-old-impl.cpp)
  target_link_libraries(test-old-impl disort-cpp artstime cdisort)
endif ()
