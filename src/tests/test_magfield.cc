#include <iostream>

#include "legendre.h"

std::string gstr =
    " 0 0 0 0 0 0 0 0 0 0 0 0 0 0"
    " -29404.8 -1450.9 0 0 0 0 0 0 0 0 0 0 0 0"
    " -2499.6 2982 1677 0 0 0 0 0 0 0 0 0 0 0"
    " 1363.2 -2381.2 1236.2 525.7 0 0 0 0 0 0 0 0 0 0"
    " 903 809.5 86.3 -309.4 48 0 0 0 0 0 0 0 0 0"
    " -234.3 363.2 187.8 -140.7 -151.2 13.5 0 0 0 0 0 0 0 0"
    " 66 65.5 72.9 -121.5 -36.2 13.5 -64.7 0 0 0 0 0 0 0"
    " 80.6 -76.7 -8.2 56.5 15.8 6.4 -7.2 9.8 0 0 0 0 0 0"
    " 23.7 9.7 -17.6 -0.5 -21.1 15.3 13.7 -16.5 -0.3 0 0 0 0 0"
    " 5 8.4 2.9 -1.5 -1.1 -13.2 1.1 8.8 -9.3 -11.9 0 0 0 0"
    " -1.9 -6.2 -0.1 1.7 -0.9 0.7 -0.9 1.9 1.4 -2.4 -3.8 0 0 0"
    " 3 -1.4 -2.5 2.3 -0.9 0.3 -0.7 -0.1 1.4 -0.6 0.2 3.1 0 0"
    " -2 -0.1 0.5 1.3 -1.2 0.7 0.3 0.5 -0.3 -0.5 0.1 -1.1 -0.3 0"
    " 0.1 -0.9 0.5 0.7 -0.3 0.8 0 0.8 0 0.4 0.1 0.5 -0.5 -0.4";

std::string hstr =
    " 0 0 0 0 0 0 0 0 0 0 0 0 0 0"
    " 0 4652.5 0 0 0 0 0 0 0 0 0 0 0 0"
    " 0 -2991.6 -734.6 0 0 0 0 0 0 0 0 0 0 0"
    " 0 -82.1 241.9 -543.4 0 0 0 0 0 0 0 0 0 0"
    " 0 281.9 -158.4 199.7 -349.7 0 0 0 0 0 0 0 0 0"
    " 0 47.7 208.3 -121.2 32.3 98.9 0 0 0 0 0 0 0 0"
    " 0 -19.1 25.1 52.8 -64.5 8.9 68.1 0 0 0 0 0 0 0"
    " 0 -51.5 -16.9 2.2 23.5 -2.2 -27.2 -1.8 0 0 0 0 0 0"
    " 0 8.4 -15.3 12.8 -11.7 14.9 3.6 -6.9 2.8 0 0 0 0 0"
    " 0 -23.4 11 9.8 -5.1 -6.3 7.8 0.4 -1.4 9.6 0 0 0 0"
    " 0 3.4 -0.2 3.6 4.8 -8.6 -0.1 -4.3 -3.4 -0.1 -8.8 0 0 0"
    " 0 0 2.5 -0.6 -0.4 0.6 -0.2 -1.7 -1.6 -3 -2 -2.6 0 0"
    " 0 -1.2 0.5 1.4 -1.8 0.1 0.8 -0.2 0.6 0.2 -0.9 0 0.5 0"
    " 0 -0.9 0.6 1.4 -0.4 -1.3 -0.1 0.3 -0.1 0.5 0.5 -0.4 -0.4 -0.6";

int main() {
  auto hstream = std::stringstream(hstr);
  auto gstream = std::stringstream(gstr);

  Matrix g(14, 14), h(14, 14);
  for (Index i = 0; i < 14; i++) {
    for (Index j = 0; j < 14; j++) {
      gstream >> g[i, j];
      hstream >> h[i, j];
    }
  }

  for (Numeric lat = -90.0; lat <= 90.0; lat += 2.5) {
    for (Numeric lon = 0.0; lon <= 360.0; lon += 2.5) {
      const auto [Bu, Bv, Bw] =
          Legendre::schmidt_fieldcalc(g, h, 6371.2e3, {6371.2e3, lat, lon});
      std::cout << lat << ' ' << lon << ' ' << Bu << ' ' << Bv << ' ' << Bw
                << ' ' << std::hypot(Bu, Bv, Bw) << '\n';
    }
  }
}
